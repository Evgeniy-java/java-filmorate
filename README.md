# java-filmorate application
![filmorate DB ER-diagram](images/filmorate_ER-diagram.png)

## Пояснение к схеме

### films
Содержание информации о фильмах.
#### Таблица состоит из полей:
+ первичный ключ ```film_id``` - идентификатор фильма;
+ ```name``` - название фильма;
+ ```description``` - описание фильма;
+ ```relese_date``` - год выхода;
+ ```duration``` - продолжительность фильма в минутах;
+ внешний ключ ```genre_id``` - идентификатор жанра;
+ внешний ключ ```mpa_id``` - идентификатор рейтинга;

### mpa
Содержит информацию о рейтинге Ассоциации кинокомпаний (MPA)
#### В таблицу входят поля:
+ первичный ключ ```mpa_id``` - идентификатор рейтинга;
+ ```rating``` - возрастной рейтинг;
+ ```description``` - описание рейтинга например:
	 - PG - детям рекомендуется смотреть такой фильм с родителями;
	- PG-13 - детям до 13 лет смотреть такой фильм нежелательно.

### film_genre
Содержит информатцию идентификаторов жанра и фильма, образуют составной ключ между таблицами films и genre
#### В таблицу входят поля:
+первичный ключ ```genre_id``` - идентификатор жанра;
+внешний ключ ```film_id``` - идентификатор фильма.

### genre
Содержит информацию о жанрах кино.
#### В таблицу входят поля:
+ первичный ключ ```genre_id``` - идентификатор жанра;
+ ```name``` - название жанра.

### film_likes
Содержит информацию о лайках к фильмам которые поставили пользователи.
#### В таблицу входят поля:
+ первичный ключ ```film_id``` - идентификатор фильма;
+ вторичный ключ ```user_id``` - идентификатор пользователя.

### friendship
Содержит информацию о статусе заявок в друзья.
#### В таблицу входят поля:
+ первичный ключ ```user_from``` - идентификатор пользователя;
+ ```user_to``` - идентификатор пользователя для дружбы;
+ ```status``` - статус дружбы.

### users
Содержит данные о пользователях.
#### Таблица включает поля:
+ первичный ключ ```user_id``` - идентификатор пользователя;
+ ```email``` - электронная почта;
+ ```login``` - имя авторизации пользователя;
+ ```first_name``` - имя пользователя;
+ ```birthday``` - дата рождения пользователя.


##Примеры запросов приложения:
+ Добавить поле genre к таблице movie и вывести информацию о фильмах.
```
SELECT *
FROM films AS f
INNER JOIN film_genre AS fG ON f.id=fG.film_id;
INNER JOIN genre AS g ON g.genre_id=fG.genre_id;
```

+ Узнать топ 20 фильмов по количеству лайков.
```
SELECT m.name, 
       COUNT(fL.user_id) AS count_likes
FROM films AS m
INNER JOIN film_like AS fL ON m.film_id=fL.film_id
GROUP BY m.name
ORDER BY count_likes DESC
LIMIT 20; 
```

+ Узнать топ 10 пользователей с максимальным количеством друзей
```
SELECT u.first_name, 
       COUNT(f.user_id) AS count_friends
FROM users AS u
INNER JOIN friendship AS f ON u.id=f.user_to
WHERE status = 'CONFIRMED'
GROUP BY u.first_name
ORDER BY count_friends DESC
LIMIT 10; 
```


